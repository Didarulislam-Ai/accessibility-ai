(()=>{var e={};e.id=25,e.ids=[25],e.modules={918:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>l,serverHooks:()=>w,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>d});var i=r(96559),a=r(48088),o=r(37719),n=r(32190),u=r(85229),p=r(37740);let c=new u.A(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16"});async function d(e){let t,r=e.headers.get("stripe-signature"),s=await e.text();try{t=c.webhooks.constructEvent(s,r,process.env.STRIPE_WEBHOOK_SECRET)}catch(e){return console.error("Webhook signature verification failed.",e),n.NextResponse.json({error:"Invalid signature"},{status:400})}if("checkout.session.completed"===t.type){let e=t.data.object,r=e.customer,s=e.customer_email,i=await p.z.user.findUnique({where:{email:s}});i?i.stripeCustomerId||await p.z.user.update({where:{email:s},data:{stripeCustomerId:r}}):i=await p.z.user.create({data:{email:s,stripeCustomerId:r}});let a=e.subscription,o=await c.subscriptions.retrieve(a),n=`ak_${Math.random().toString(36).substring(2)}${Date.now().toString(36)}`;await p.z.subscription.create({data:{userId:i.id,apiKey:n,status:"active",plan:o.items.data[0].price.id,expiresAt:new Date(1e3*o.current_period_end)}})}return n.NextResponse.json({received:!0})}let l=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/stripe-webhook/route",pathname:"/api/stripe-webhook",filename:"route",bundlePath:"app/api/stripe-webhook/route"},resolvedPagePath:"/Users/didershine/Documents/accessibility-dashboard/app/api/stripe-webhook/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:w}=l;function m(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},37740:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});let s=require("@prisma/client"),i=global.prisma||new s.PrismaClient},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[243,580,229],()=>r(918));module.exports=s})();